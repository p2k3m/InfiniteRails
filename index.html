<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Infinite Dimension · Portals Reimagined</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;600;700&family=Exo+2:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="background-sheen"></div>
    <header class="top-bar">
      <div class="logo-area">
        <img src="assets/infinite-dimension-logo.svg" alt="Infinite Dimension logo" class="brand-logo" />
        <div class="brand-copy">
          <h1>Infinite Dimension</h1>
          <span class="subtitle">Portals Reimagined</span>
        </div>
      </div>
      <div class="top-actions">
        <button type="button" id="openGuide" class="ghost">Game Guide</button>
        <div class="status-area">
          <div class="status-item hearts" id="hearts"></div>
          <div class="status-item bubbles" id="bubbles"></div>
          <div class="status-item time" id="timeOfDay"></div>
        </div>
        <div class="user-identity" aria-live="polite">
          <span class="user-name" id="headerUserName">Guest Explorer</span>
          <span class="user-location" id="headerUserLocation">Location unavailable</span>
        </div>
      </div>
    </header>
    <main class="main-layout">
      <section class="primary-panel">
        <canvas id="gameCanvas" width="960" height="600" aria-label="Game world"></canvas>
        <div class="overlay-panel" id="dimensionInfo" aria-live="polite"></div>
        <div
          class="portal-progress"
          id="portalProgress"
          role="progressbar"
          aria-valuemin="0"
          aria-valuemax="100"
          aria-valuenow="0"
        >
          <span class="label"></span>
          <span class="bar"></span>
        </div>
        <div class="victory-banner" id="victoryBanner" role="status" aria-live="assertive"></div>
      </section>
      <aside class="side-panel">
        <section class="player-panel" aria-label="Player profile">
          <header class="player-panel__header">
            <h2>Player Hub</h2>
            <button type="button" id="googleSignOut" class="ghost small" hidden>Sign out</button>
          </header>
          <div class="player-panel__content">
            <div class="identity-pill" id="userNameDisplay">Guest Explorer</div>
            <div class="identity-meta">
              <span id="userLocationDisplay">Location unavailable</span>
              <span id="userDeviceDisplay">Device details pending</span>
            </div>
            <div id="googleButtonContainer" class="gsi-container" hidden></div>
            <button type="button" id="googleFallbackSignIn" class="primary">Sign in with Google</button>
            <p class="player-panel__hint">
              Sign in to capture your location badge, sync your device fingerprint, and compete on the Infinite Dimension scorecard.
            </p>
          </div>
        </section>
        <section class="scoreboard-panel" id="scoreboardSection" aria-label="Multiverse scoreboard" hidden>
          <header>
            <h2>Multiverse Scoreboard</h2>
            <button type="button" id="refreshScores" class="ghost small">Refresh</button>
          </header>
          <p class="scoreboard-status" id="scoreboardStatus" aria-live="polite">Sign in to view the multiverse scorecard.</p>
          <ol class="scoreboard-list" id="scoreboardList" aria-live="polite"></ol>
        </section>
        <section class="inventory-panel">
          <h2>Inventory</h2>
          <div class="hotbar" id="hotbar"></div>
          <button class="toggle-extended" id="toggleExtended">Open Satchel</button>
          <div class="extended" id="extendedInventory"></div>
        </section>
        <section class="crafting-panel">
          <header>
            <h2>Crafting</h2>
            <div class="craft-search">
              <input type="search" id="recipeSearch" placeholder="Search recipes" />
            </div>
          </header>
          <div class="craft-queue" id="craftQueue" aria-live="polite"></div>
          <div class="craft-controls">
            <div class="craft-target" id="craftTarget"></div>
            <button id="craftButton" class="primary">Craft</button>
            <button id="clearCraft" class="ghost">Clear</button>
          </div>
          <div class="recipe-list" id="recipeList"></div>
        </section>
        <section class="codex-panel" aria-label="Dimension codex">
          <header>
            <h2>Dimension Codex</h2>
          </header>
          <ul id="dimensionCodex"></ul>
        </section>
        <section class="log-panel" aria-live="polite">
          <header>
            <h2>Event Log</h2>
          </header>
          <ul id="eventLog"></ul>
        </section>
      </aside>
    </main>
    <footer class="footer">
      <div class="controls">
        <div>
          <h3>Desktop Controls</h3>
          <p>
            WASD/Arrows move · Space interact · Q place block · E inventory · R build portal · F use · Shift sprint · Drag to
            orbit · Scroll to zoom
          </p>
        </div>
        <div>
          <h3>Mobile Controls</h3>
          <p>Swipe to move · Tap hold to interact · Tap buttons for craft/build</p>
        </div>
      </div>
      <div class="signature">Created by Manu</div>
    </footer>

    <div class="modal" id="introModal" role="dialog" aria-modal="true" aria-labelledby="introTitle">
      <div class="modal-content">
        <h2 id="introTitle">Welcome to Infinite Dimension</h2>
        <p>
          Survive, craft, and weave portals across dimensions. Gather resources from each world, solve rail puzzles,
          and bring home the Eternal Ingot.
        </p>
        <ul class="modal-highlights">
          <li>Build 4×3 portals with unique materials to unlock new rules.</li>
          <li>Craft using ordered sequences and uncover hidden recipes.</li>
          <li>Survive nightly assaults while protecting villagers and rails.</li>
        </ul>
        <button id="startButton" class="primary">Enter the Rails</button>
      </div>
    </div>

    <div
      class="modal guide-modal"
      id="guideModal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="guideTitle"
      hidden
    >
      <article class="guide-content" data-guide-scroll>
        <header class="guide-header">
          <div>
            <p class="guide-eyebrow">Game Design Document &amp; User Manual</p>
            <h2 id="guideTitle">Infinite Dimension: Portals Reimagined</h2>
          </div>
          <button type="button" class="ghost" data-close-guide>Close</button>
        </header>
        <section class="guide-section">
          <h3>Game Overview</h3>
          <p>
            Infinite Dimension is a browser-based voxel survival puzzle. Gather resources, craft ordered recipes, and build
            precise 4×3 portals to leap between realms. Each portal material rewrites the physics and threats of the
            destination dimension.
          </p>
          <ul>
            <li>Portals are the only way to explore fresh territories.</li>
            <li>Every material introduces a bespoke challenge and reward loop.</li>
            <li>Crafting is performed by sequencing items rather than arranging them in a grid.</li>
          </ul>
        </section>
        <section class="guide-section">
          <h3>Look &amp; Feel</h3>
          <p>Each dimension features a distinct ambience, palette, and soundtrack cues:</p>
          <ul>
            <li><strong>Rock:</strong> rugged canyons with dense gravity and ore-rich chasms.</li>
            <li><strong>Stone:</strong> glowing monochrome rails that phase in rhythmic patterns.</li>
            <li><strong>Tar:</strong> a viscous, low-visibility swamp that slows movement.</li>
            <li><strong>Marble:</strong> mirror-bright courtyards where actions echo after five seconds.</li>
            <li><strong>Netherite:</strong> molten rails collapse behind every step — the final gauntlet.</li>
          </ul>
        </section>
        <section class="guide-section">
          <h3>How to Play</h3>
          <ol>
            <li>Spawn on a quiet grass island. Search trees and stones for early materials.</li>
            <li>Use the craft circle next to your hearts to arrange items in the correct sequence.</li>
            <li>Build a 4×3 portal frame from a single material, leave the centre empty, and ignite it.</li>
            <li>Explore the new realm, solve its rail puzzle, and gather the unique loot inside.</li>
            <li>Survive the nightly zombie raids, protect villagers, and stabilise the rails.</li>
            <li>Repeat with higher-tier materials until you conquer the collapsing Netherite dimension.</li>
          </ol>
        </section>
        <section class="guide-section two-column">
          <div>
            <h4>Controls (Desktop)</h4>
            <ul>
              <li><kbd>WASD</kbd> / <kbd>Arrows</kbd> — move &amp; switch rails</li>
              <li><kbd>Space</kbd> — jump gaps</li>
              <li><kbd>Mouse</kbd> — look, mine, place</li>
              <li><kbd>E</kbd> — inventory</li>
              <li><kbd>F</kbd> — interact</li>
              <li><kbd>R</kbd> — build portals</li>
            </ul>
          </div>
          <div>
            <h4>Controls (Mobile)</h4>
            <ul>
              <li>Swipe to swap rails</li>
              <li>Tap &amp; hold to mine or place blocks</li>
              <li>Drag to move the camera</li>
              <li>Use the hotbar for quick slots and the craft circle for recipes</li>
            </ul>
          </div>
        </section>
        <section class="guide-section">
          <h3>Dimensions &amp; Objectives</h3>
          <dl class="dimension-list">
            <div>
              <dt>Rock Portal</dt>
              <dd>Stronger gravity and sliding slopes. Rewards heavy ores and plating.</dd>
            </div>
            <div>
              <dt>Stone Portal</dt>
              <dd>Rails appear and vanish to a rhythm. Collect pattern crystals for sync tech.</dd>
            </div>
            <div>
              <dt>Tar Portal</dt>
              <dd>Movement is heavy and tar slugs pursue you. Gather sticky sacs for traps.</dd>
            </div>
            <div>
              <dt>Marble Portal</dt>
              <dd>Your actions echo after five seconds. Use the reverbs to solve mirrored puzzles.</dd>
            </div>
            <div>
              <dt>Netherite Portal</dt>
              <dd>Rails crumble behind you. Sprint, align collapsing tracks, and seize the Eternal Ingot.</dd>
            </div>
          </dl>
        </section>
        <section class="guide-section">
          <h3>Survival Cycle</h3>
          <p>
            Daytime is safe for crafting and exploration. When night falls, zombies swarm the rails and villagers risk
            conversion. Keep torches lit, stand your ground, and repair damage before dawn. Underwater exploration is
            limited by your bubbles: once they deplete, hearts drain rapidly.
          </p>
        </section>
        <section class="guide-section">
          <h3>Winning a Run</h3>
          <p>
            Reach the Netherite dimension, stabilise collapsing rails long enough to grab the Eternal Ingot, and return
            to the Grassland Threshold. Delivering the ingot home completes the run and logs your time on the leaderboards.
          </p>
        </section>
      </article>
    </div>

    <div class="mobile-controls" id="mobileControls">
      <button data-action="left">◀</button>
      <button data-action="up">▲</button>
      <button data-action="down">▼</button>
      <button data-action="right">▶</button>
      <button data-action="action" class="accent">✦</button>
      <button data-action="portal" class="accent">⧉</button>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="script.js" type="module"></script>
  </body>
</html>
